<!-- ============================================ -->
<!-- PART 1 OF 3: HTML STRUCTURE + CSS STYLES -->
<!-- Copy this entire section first -->
<!-- ============================================ -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PECR Compliance Check</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #ffffff;
      line-height: 1.6;
      overflow-x: hidden;
    }
    
    /* ==================== HEADER ==================== */
    .top-header {
      background: white;
      border-bottom: 1px solid #f0f0f0;
      padding: 20px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .brand-name {
      font-size: 24px;
      font-weight: 700;
      color: #1a1a1a;
    }
    
    .header-actions {
      display: flex;
      gap: 15px;
      align-items: center;
    }
    
    .compliance-badge {
      display: none;
      align-items: center;
      gap: 10px;
      padding: 12px 20px;
      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
      border-radius: 25px;
      border: 2px solid #86efac;
    }
    
    .compliance-badge.visible {
      display: flex;
    }
    
    .compliance-badge .score {
      font-size: 24px;
      font-weight: 700;
      color: #166534;
    }
    
    .compliance-badge .label {
      font-size: 13px;
      color: #15803d;
      font-weight: 600;
    }
    
    /* ==================== SPLIT LAYOUT ==================== */
    .split-container {
      display: flex;
      min-height: calc(100vh - 81px);
    }
    
    .left-panel {
      width: 40%;
      background: linear-gradient(165deg, #f97316 0%, #ea580c 100%);
      padding: 60px 50px;
      color: white;
      position: relative;
      overflow: hidden;
    }
    
    .left-panel::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -20%;
      width: 500px;
      height: 500px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 50%;
    }
    
    .left-content {
      position: relative;
      z-index: 2;
    }
    
    .panel-title {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 20px;
      line-height: 1.2;
    }
    
    .panel-subtitle {
      font-size: 18px;
      opacity: 0.9;
      margin-bottom: 40px;
      line-height: 1.6;
    }
    
    .score-widget {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }
    
    .score-widget h3 {
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
      opacity: 0.9;
      margin-bottom: 20px;
    }
    
    .score-display {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .score-number {
      font-size: 56px;
      font-weight: 700;
      line-height: 1;
    }
    
    .score-meter {
      flex: 1;
    }
    
    .score-bar-bg {
      height: 12px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      overflow: hidden;
      position: relative;
    }
    
    .score-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #fbbf24, #22c55e);
      border-radius: 6px;
      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .score-bar-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }
    
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    .score-labels {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      margin-top: 8px;
      opacity: 0.8;
    }
    
    .risk-indicator {
      display: inline-block;
      padding: 6px 14px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      margin-top: 15px;
    }
    
    .section-progress {
      margin-top: 30px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .section-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      margin-bottom: 8px;
      transition: all 0.3s ease;
    }
    
    .section-item.active {
      background: rgba(255, 255, 255, 0.25);
      border: 2px solid rgba(255, 255, 255, 0.4);
    }
    
    .section-item.completed {
      opacity: 0.7;
    }
    
    .section-icon {
      width: 32px;
      height: 32px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }
    
    .section-item.completed .section-icon {
      background: rgba(34, 197, 94, 0.3);
    }
    
    .section-item.active .section-icon {
      background: white;
      color: #f97316;
    }
    
    .section-info {
      flex: 1;
      min-width: 0;
    }
    
    .section-name {
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .section-questions {
      font-size: 12px;
      opacity: 0.8;
    }
    
    .stats-box {
      margin-top: 30px;
      padding: 25px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      backdrop-filter: blur(10px);
    }
    
    .stats-box h3 {
      font-size: 14px;
      opacity: 0.8;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .stats-box .big-number {
      font-size: 36px;
      font-weight: 700;
    }
    
    .right-panel {
      width: 60%;
      padding: 60px 80px;
      background: #fafafa;
      position: relative;
    }
    
    .form-wrapper {
      max-width: 650px;
    }
    
    .question-container {
      display: none;
      animation: slideIn 0.4s ease;
    }
    
    .question-container.active {
      display: block;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    .question-meta {
      color: #f97316;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .section-badge {
      background: rgba(249, 115, 22, 0.1);
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
    }
    
    .question-text {
      font-size: 32px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 20px;
      line-height: 1.3;
    }
    
    .question-description {
      font-size: 17px;
      color: #666;
      margin-bottom: 40px;
      line-height: 1.6;
      background: #fff7ed;
      padding: 20px;
      border-radius: 12px;
      border-left: 4px solid #f97316;
    }
    
    input[type="text"],
    textarea {
      width: 100%;
      padding: 18px 20px;
      font-size: 16px;
      border: 2px solid #e5e5e5;
      border-radius: 10px;
      transition: all 0.3s ease;
      font-family: inherit;
      background: white;
    }
    
    input[type="text"]:focus,
    textarea:focus {
      outline: none;
      border-color: #f97316;
      box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
    }
    
    .options-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .option-button {
      padding: 18px 25px;
      border: 2px solid #e5e5e5;
      background: white;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: left;
      font-size: 16px;
      font-family: inherit;
      font-weight: 500;
      color: #333;
      position: relative;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .option-button::before {
      content: '';
      width: 20px;
      height: 20px;
      border: 2px solid #d1d5db;
      border-radius: 50%;
      flex-shrink: 0;
      transition: all 0.3s ease;
    }
    
    .option-button:hover {
      border-color: #f97316;
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.1);
    }
    
    .option-button.selected {
      border-color: #f97316;
      background: #fff7ed;
      color: #1a1a1a;
      font-weight: 600;
    }
    
    .option-button.selected::before {
      border-color: #f97316;
      background: #f97316;
      box-shadow: inset 0 0 0 4px white;
    }
    
    .option-button.checkbox::before {
      border-radius: 4px;
    }
    
    .option-button.checkbox.selected::before {
      background: #f97316;
      border-color: #f97316;
      content: '‚úì';
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 14px;
      font-weight: bold;
    }
    
    .button-group {
      display: flex;
      gap: 15px;
      margin-top: 50px;
    }
    
    button {
      padding: 16px 32px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      font-family: inherit;
    }
    
    .btn-primary {
      background: #f97316;
      color: white;
      flex: 1;
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
    }
    
    .btn-primary:hover {
      background: #ea580c;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(249, 115, 22, 0.4);
    }
    
    .btn-primary:disabled {
      background: #d1d5db;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .btn-secondary {
      background: white;
      color: #666;
      border: 2px solid #e5e5e5;
      min-width: 120px;
    }
    
    .btn-secondary:hover {
      background: #f9f9f9;
      border-color: #d1d5db;
    }
    
    .auto-save-indicator {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: white;
      padding: 12px 20px;
      border-radius: 25px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: none;
      align-items: center;
      gap: 10px;
      z-index: 1000;
      animation: slideUp 0.3s ease;
    }
    
    .auto-save-indicator.visible {
      display: flex;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .save-spinner {
      width: 16px;
      height: 16px;
      border: 2px solid #e5e5e5;
      border-top-color: #f97316;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .loading {
      display: none;
      text-align: center;
      padding: 60px 40px;
    }
    
    .loading.active {
      display: block;
    }
    
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #f97316;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
      margin: 0 auto 25px;
    }
    
    .loading p {
      font-size: 18px;
      color: #666;
    }
    
    .result-container {
      display: none;
      padding: 60px 40px;
    }
    
    .result-container.active {
      display: block;
    }
    
    .result-header {
      text-align: center;
      margin-bottom: 50px;
    }
    
    .result-icon {
      font-size: 80px;
      margin-bottom: 25px;
    }
    
    .result-title {
      font-size: 42px;
      font-weight: 700;
      margin-bottom: 20px;
    }
    
    .result-message {
      font-size: 19px;
      color: #666;
      margin-bottom: 40px;
      line-height: 1.6;
    }
    
    .risk-heatmap {
      background: white;
      padding: 40px;
      border-radius: 16px;
      margin-bottom: 40px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }
    
    .risk-heatmap h3 {
      font-size: 24px;
      margin-bottom: 30px;
      color: #1a1a1a;
    }
    
    .heatmap-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
    }
    
    .heatmap-item {
      padding: 20px;
      border-radius: 12px;
      border-left: 4px solid;
      transition: all 0.3s ease;
    }
    
    .heatmap-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .heatmap-item.risk-low {
      background: #f0fdf4;
      border-left-color: #22c55e;
    }
    
    .heatmap-item.risk-medium {
      background: #fffbeb;
      border-left-color: #f59e0b;
    }
    
    .heatmap-item.risk-high {
      background: #fef2f2;
      border-left-color: #ef4444;
    }
    
    .heatmap-item h4 {
      font-size: 16px;
      margin-bottom: 8px;
      color: #1a1a1a;
    }
    
    .heatmap-item .score {
      font-size: 24px;
      font-weight: 700;
    }
    
    .heatmap-item.risk-low .score {
      color: #166534;
    }
    
    .heatmap-item.risk-medium .score {
      color: #92400e;
    }
    
    .heatmap-item.risk-high .score {
      color: #991b1b;
    }
    
    .recommendations {
      background: white;
      padding: 40px;
      border-radius: 16px;
      margin-bottom: 40px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }
    
    .recommendations h3 {
      font-size: 24px;
      margin-bottom: 30px;
      color: #1a1a1a;
    }
    
    .recommendation-item {
      padding: 20px;
      border-left: 4px solid #f97316;
      background: #fff7ed;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    
    .recommendation-item h4 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #1a1a1a;
    }
    
    .recommendation-item p {
      font-size: 14px;
      color: #666;
      line-height: 1.6;
    }
    
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 25px;
      padding: 40px;
    }
    
    .dashboard-card {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: all 0.3s ease;
      border-left: 4px solid transparent;
      cursor: pointer;
    }
    
    .dashboard-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }
    
    .dashboard-card.compliant {
      border-left-color: #10b981;
      background: linear-gradient(to right, #ecfdf5 0%, white 10%);
    }
    
    .dashboard-card.warning {
      border-left-color: #f59e0b;
      background: linear-gradient(to right, #fffbeb 0%, white 10%);
    }
    
    .dashboard-card.non-compliant {
      border-left-color: #ef4444;
      background: linear-gradient(to right, #fef2f2 0%, white 10%);
    }
    
    .dashboard-card h3 {
      font-size: 20px;
      margin-bottom: 15px;
      color: #1a1a1a;
    }
    
    .dashboard-card .result-badge {
      display: inline-block;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 15px;
    }
    
    .compliant .result-badge {
      background: #d1fae5;
      color: #065f46;
    }
    
    .warning .result-badge {
      background: #fef3c7;
      color: #92400e;
    }
    
    .non-compliant .result-badge {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .dashboard-card .date {
      color: #999;
      font-size: 14px;
    }
    
    .dashboard-card .score-display-mini {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 15px;
    }
    
    .dashboard-card .score-number-mini {
      font-size: 32px;
      font-weight: 700;
    }
    
    .empty-state {
      background: white;
      padding: 80px 40px;
      border-radius: 12px;
      text-align: center;
      margin: 40px;
    }
    
    .empty-state h2 {
      font-size: 28px;
      margin-bottom: 15px;
      color: #1a1a1a;
    }
    
    .empty-state p {
      font-size: 18px;
      color: #666;
      margin-bottom: 30px;
    }
    
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background: #f97316;
      position: absolute;
      animation: confetti-fall 3s linear forwards;
    }
    
    @keyframes confetti-fall {
      to {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }
    
    @media (max-width: 968px) {
      .split-container {
        flex-direction: column;
      }
      
      .left-panel,
      .right-panel {
        width: 100%;
      }
      
      .left-panel {
        padding: 40px 30px;
      }
      
      .right-panel {
        padding: 40px 30px;
      }
      
      .question-text {
        font-size: 24px;
      }
      
      .top-header {
        padding: 15px 20px;
        flex-wrap: wrap;
      }
      
      .compliance-badge {
        order: 3;
        width: 100%;
        margin-top: 10px;
      }
      
      .dashboard-grid {
        grid-template-columns: 1fr;
        padding: 20px;
      }
      
      .heatmap-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .form-container.hidden {
      display: none;
    }
  </style>
</head>
<body>
<!-- ============================================ -->
<!-- PART 2 OF 3: HTML BODY STRUCTURE -->
<!-- Copy this section after Part 1 -->
<!-- ============================================ -->

  <!-- Top Header -->
  <div class="top-header">
    <div class="logo-container">
      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 200 200">
        <path d="M0 0 C163.02 0 326.04 0 494 0 C494 31.35 494 62.7 494 95 C330.98 95 167.96 95 0 95 C0 63.65 0 32.3 0 0 Z " fill="#FCFCFB" transform="translate(0,0)"/>
        <path d="M0 0 C6.6 0 13.2 0 20 0 C20 25.41 20 50.82 20 77 C15.05 77 10.1 77 5 77 C4.67 75.35 4.34 73.7 4 72 C2.9275 72.61875 1.855 73.2375 0.75 73.875 C-0.49448778 74.59297372 -1.74478166 75.30095564 -3 76 C-3.57492188 76.36867188 -4.14984375 76.73734375 -4.7421875 77.1171875 C-8.07303885 78.4195619 -11.3530687 78.28877356 -14.875 78.25 C-15.56980469 78.25773437 -16.26460937 78.26546875 -16.98046875 78.2734375 C-25.28095239 78.24217391 -31.03397 75.58469612 -37 70 C-43.48568277 61.79896032 -44.97889703 53.28446139 -44 43 C-41.65526128 33.73511348 -37.00062432 27.87002512 -28.8671875 22.98046875 C-24.81918227 20.85484257 -21.32298392 20.80428867 -16.8125 20.75 C-15.54019531 20.72421875 -14.26789063 20.6984375 -12.95703125 20.671875 C-9 21 -9 21 -1 24 C-0.67 16.08 -0.34 8.16 0 0 Z " fill="#EE973F" transform="translate(226,10)"/>
        <path d="M0 0 C6.93 0 13.86 0 21 0 C24.66059603 8.57625355 27.93971252 17.19679005 31 26 C32.83924204 23.24113694 33.81462726 21.02578385 34.91015625 17.9296875 C35.26013672 16.95128906 35.61011719 15.97289062 35.97070312 14.96484375 C36.33099609 13.94519531 36.69128906 12.92554688 37.0625 11.875 C37.78003304 9.85066785 38.49995563 7.82718055 39.22265625 5.8046875 C39.53984619 4.90733887 39.85703613 4.00999023 40.18383789 3.08544922 C41 1 41 1 42 0 C44.69654854 -0.07319621 47.36691458 -0.09242537 50.0625 -0.0625 C50.82111328 -0.05798828 51.57972656 -0.05347656 52.36132812 -0.04882812 C54.24091871 -0.0370068 56.12046899 -0.01907078 58 0 C58.2673999 0.74685059 58.5347998 1.49370117 58.81030273 2.26318359 C60.0180808 5.63425204 61.22776589 9.00463303 62.4375 12.375 C62.85837891 13.550625 63.27925781 14.72625 63.71289062 15.9375 C64.11572266 17.05898438 64.51855469 18.18046875 64.93359375 19.3359375 C65.4913147 20.89127197 65.4913147 20.89127197 66.06030273 22.47802734 C66.92952058 24.94802049 66.92952058 24.94802049 68 27 C68.2673999 26.25314941 68.5347998 25.50629883 68.81030273 24.73681641 C70.0180808 21.36574796 71.22776589 17.99536697 72.4375 14.625 C72.85837891 13.449375 73.27925781 12.27375 73.71289062 11.0625 C74.11572266 9.94101562 74.51855469 8.81953125 74.93359375 7.6640625 C75.30540771 6.62717285 75.67722168 5.5902832 76.06030273 4.52197266 C77 2 77 2 78 0 C84.93 0 91.86 0 99 0 C95.625 11.25 95.625 11.25 94.09887695 15.26611328 C93.75875076 16.16629181 93.41862457 17.06647034 93.06819153 17.993927 C92.53363594 19.39298782 92.53363594 19.39298782 91.98828125 20.8203125 C91.61519333 21.80498505 91.24210541 22.78965759 90.85771179 23.8041687 C89.67919847 26.91234758 88.49593566 30.01869242 87.3125 33.125 C86.50684522 35.24727581 85.7015037 37.36967057 84.89648438 39.4921875 C82.9346061 44.66283963 80.96846969 49.83185383 79 55 C72.73 55 66.46 55 60 55 C56.7 46.09 53.4 37.18 50 28 C45.90669983 37.7886857 45.90669983 37.7886857 42.25 47.6875 C40.10684474 53.89315526 40.10684474 53.89315526 39 55 C37.65732587 55.08631874 36.31025678 55.10706473 34.96484375 55.09765625 C34.15595703 55.09443359 33.34707031 55.09121094 32.51367188 55.08789062 C31.66353516 55.07951172 30.81339844 55.07113281 29.9375 55.0625 C29.08349609 55.05798828 28.22949219 55.05347656 27.34960938 55.04882812 C25.23304337 55.03700373 23.11651315 55.01906769 21 55 C16.19768381 45.24323821 12.54715253 35.04322648 8.78686523 24.85351562 C7.67679436 21.84599515 6.56055254 18.8408187 5.44335938 15.8359375 C4.73662372 13.92981925 4.03023065 12.02357394 3.32421875 10.1171875 C2.82277596 8.76583206 2.82277596 8.76583206 2.311203 7.38717651 C2.00700943 6.56186432 1.70281586 5.73655212 1.3894043 4.88623047 C1.12024704 4.15773895 0.85108978 3.42924744 0.57377625 2.67868042 C0 1 0 1 0 0 Z " fill="#EE973F" transform="translate(248,32)"/>
      </svg>
      <span class="brand-name">sendwize</span>
    </div>
    <div class="header-actions">
      <div class="compliance-badge visible" id="headerScoreBadge">
        <div>
          <div class="score" id="headerScore">0%</div>
          <div class="label">Compliance</div>
        </div>
      </div>
      <!-- Button removed - users access through Webflow -->
    </div>
  </div>
  
  <!-- Auto-save Indicator -->
  <div class="auto-save-indicator" id="autoSaveIndicator">
    <div class="save-spinner"></div>
    <span>Saving draft...</span>
  </div>
  
  <!-- Split Screen Form -->
  <div class="form-container hidden" id="formContainer">
    <div class="split-container">
      
      <!-- LEFT PANEL -->
      <div class="left-panel">
        <div class="left-content">
          <h1 class="panel-title">GDPR/PECR Compliance</h1>
          <p class="panel-subtitle">Complete this comprehensive assessment to ensure your marketing campaign meets all UK regulations.</p>
          
          <!-- Compliance Score Widget -->
          <div class="score-widget">
            <h3>Compliance Score</h3>
            <div class="score-display">
              <div class="score-number" id="complianceScore">0%</div>
              <div class="score-meter">
                <div class="score-bar-bg">
                  <div class="score-bar-fill" id="scoreBarFill" style="width: 0%"></div>
                </div>
                <div class="score-labels">
                  <span>Non-Compliant</span>
                  <span>Compliant</span>
                </div>
              </div>
            </div>
            <div class="risk-indicator" id="riskIndicator">‚ö†Ô∏è Assessment in progress</div>
          </div>
          
          <!-- Section Progress -->
          <div class="section-progress" id="sectionProgress">
            <!-- Sections will be injected here -->
          </div>
          
          <!-- Stats Box -->
          <div class="stats-box" id="statsBox">
            <h3>Your Checks</h3>
            <div class="big-number" id="totalChecks">0</div>
          </div>
        </div>
      </div>
      
      <!-- RIGHT PANEL -->
      <div class="right-panel">
        <div class="form-wrapper" id="formContent">
          <!-- Questions will be injected here -->
        </div>
        
        <div class="loading" id="loading">
          <div class="spinner"></div>
          <p>Analyzing your campaign compliance...</p>
        </div>
        
        <div class="result-container" id="resultContainer">
          <div class="result-header">
            <div class="result-icon" id="resultIcon"></div>
            <h2 class="result-title" id="resultTitle"></h2>
            <p class="result-message" id="resultMessage"></p>
          </div>
          
          <!-- Risk Heatmap -->
          <div class="risk-heatmap">
            <h3>üìä Compliance Breakdown by Section</h3>
            <div class="heatmap-grid" id="heatmapGrid">
              <!-- Heatmap items will be injected -->
            </div>
          </div>
          
          <!-- Recommendations -->
          <div class="recommendations" id="recommendationsSection">
            <h3>üí° Key Recommendations</h3>
            <div id="recommendationsList">
              <!-- Recommendations will be injected -->
            </div>
          </div>
          
          <div style="text-align: center;">
            <button class="btn-primary" onclick="backToDashboard()">
              Back to Dashboard
            </button>
          </div>
        </div>
      </div>
      
    </div>
  </div>

  <script src="https://api.memberstackapp.com/static/memberstack.js?custom" data-memberstack-id="app_cmk1jc5fs00ry0ssb70vgbz3r"></script>
  
  <script>
    // =========================
    // CONFIGURATION
    // =========================
    
    // Get redirect URL from query parameters
    const urlParams = new URLSearchParams(window.location.search);
    const redirectUrl = urlParams.get('redirect') || 'https://yourwebflowsite.com/dashboard';
    
    // Auto-save configuration
    let autoSaveTimeout = null;
    const AUTO_SAVE_DELAY = 3000; // 3 seconds
    
    // =========================
    // COMPREHENSIVE QUESTION STRUCTURE
    // All 140+ questions from your Word doc organized by section
    // =========================
    
    const questions = [
      // SECTION 1: CAMPAIGN BASICS
      {
        id: 'campaignName',
        section: 'Campaign Basics',
        sectionIcon: 'üìã',
        type: 'text',
        question: 'What is the name of your campaign?',
        description: 'Give your campaign a memorable name so you can find it later.',
        required: true
      },
      {
        id: 'isMarketing',
        section: 'Campaign Basics',
        sectionIcon: 'üìã',
        type: 'choice',
        question: 'Are you sure this is marketing?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'unsure', label: 'Unsure' }
        ],
        required: true
      },
      {
        id: 'marketingType',
        section: 'Campaign Basics',
        sectionIcon: 'üìã',
        type: 'choice',
        question: 'If unsure, are you doing any of the following:',
        options: [
          { value: 'commercial', label: 'Commercially marketing products and/or services' },
          { value: 'promotional', label: 'Promoting aims and ideals such as fundraising, political campaigns or corporate initiatives' },
          { value: 'research', label: 'Contacting individuals to solely conduct genuine market research' },
          { value: 'service', label: 'Sending service messages solely which do not involve any direct marketing' },
          { value: 'upgrade', label: 'Sending a message that actively promotes or encourages people to make use of a particular service, special offer, or upgrade' }
        ],
        showIf: (ans) => ans.isMarketing === 'unsure'
      },
      {
        id: 'directMarketing',
        section: 'Campaign Basics',
        sectionIcon: 'üìã',
        type: 'choice',
        question: 'Are you sending communications for direct marketing purposes?',
        description: 'Including activities that lead up to, directly enable or support sending direct marketing messages.',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'examples', label: 'Give me some examples' }
        ],
        required: true
      },
      {
        id: 'targeting',
        section: 'Campaign Basics',
        sectionIcon: 'üìã',
        type: 'choice',
        question: 'Are you directing the marketing at specific individuals or categories of individuals?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        required: true
      },
      {
        id: 'audience',
        section: 'Campaign Basics',
        sectionIcon: 'üìã',
        type: 'choice',
        question: 'Are you marketing B2B or B2C?',
        options: [
          { value: 'b2b', label: 'B2B (Business to Business)' },
          { value: 'b2c', label: 'B2C (Business to Consumer)' },
          { value: 'both', label: 'Both' }
        ],
        required: true
      },
      
      // SECTION 2: CHANNEL SELECTION
      {
        id: 'channels',
        section: 'Channel Selection',
        sectionIcon: 'üì±',
        type: 'multi-select',
        question: 'Which channel(s) of communication are you using?',
        description: 'Select all that apply to your campaign.',
        options: [
          { value: 'livecalls', label: 'Live calls' },
          { value: 'autocalls', label: 'Automated calls' },
          { value: 'fax', label: 'Fax' },
          { value: 'post', label: 'Post' },
          { value: 'email', label: 'Email' },
          { value: 'sms', label: 'Text messages (SMS)' },
          { value: 'mms', label: 'Picture/video messages (MMS)' },
          { value: 'voicemail', label: 'Voicemail messages' },
          { value: 'inapp', label: 'In-app messages' },
          { value: 'socialdm', label: 'Direct messages on social media' },
          { value: 'behavioral', label: 'Online behavioral advertising' },
          { value: 'socialads', label: 'Social media advertising' },
          { value: 'other', label: 'Other electronic communications' }
        ],
        required: true
      },
      
      // SECTION 3: DATA PROCESSING
      {
        id: 'personalData',
        section: 'Data Processing',
        sectionIcon: 'üîê',
        type: 'choice',
        question: 'Does your marketing activity involve processing personal data?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        required: true
      },
      {
        id: 'knowsNames',
        section: 'Data Processing',
        sectionIcon: 'üîê',
        type: 'choice',
        question: 'Despite not using names, do you know the name of any individual recipient of your direct marketing?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        showIf: (ans) => ans.personalData === 'no'
      },
      {
        id: 'specialCategory',
        section: 'Data Processing',
        sectionIcon: 'üîê',
        type: 'choice',
        question: 'Does your marketing activity involve processing special category personal data?',
        description: 'E.g., health data, religious beliefs, political opinions, racial/ethnic origin.',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        required: true
      },
      {
        id: 'inferring',
        section: 'Data Processing',
        sectionIcon: 'üîê',
        type: 'choice',
        question: 'Are you inferring or predicting special category data about individuals?',
        description: 'E.g., inferring health conditions from purchase history, predicting political opinions.',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        showIf: (ans) => ans.specialCategory === 'no'
      },
      {
        id: 'specialConsent',
        section: 'Data Processing',
        sectionIcon: 'üîê',
        type: 'choice',
        question: 'If processing special category data, do you have explicit consent for this processing?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        showIf: (ans) => ans.specialCategory === 'yes' || ans.inferring === 'yes'
      },
      {
        id: 'children',
        section: 'Data Processing',
        sectionIcon: 'üîê',
        type: 'choice',
        question: 'Will your marketing target or potentially reach children (under 18)?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'unsure', label: 'Unsure' }
        ],
        required: true
      },
      {
        id: 'childSafeguards',
        section: 'Data Processing',
        sectionIcon: 'üîê',
        type: 'choice',
        question: 'Have you considered age-appropriate safeguards and obtained appropriate consent from parents/guardians where required?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.children === 'yes'
      },
      {
        id: 'lawfulBasis',
        section: 'Data Processing',
        sectionIcon: 'üîê',
        type: 'choice',
        question: 'What is your lawful basis for processing personal data for this marketing campaign under UK GDPR?',
        options: [
          { value: 'consent', label: 'Consent' },
          { value: 'legitimate', label: 'Legitimate interests' },
          { value: 'public', label: 'Public task (public authorities only)' },
          { value: 'other', label: 'Other' },
          { value: 'unsure', label: 'Unsure' }
        ],
        required: true
      },
      {
        id: 'hasLIA',
        section: 'Data Processing',
        sectionIcon: 'üîê',
        type: 'choice',
        question: 'If relying on legitimate interests, do you have a properly documented legitimate interests assessment (LIA)?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        showIf: (ans) => ans.lawfulBasis === 'legitimate'
      },
      {
        id: 'liaBalanced',
        section: 'Data Processing',
        sectionIcon: 'üîê',
        type: 'choice',
        question: 'Has your LIA properly balanced your interests against the rights, freedoms and expectations of individuals?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.hasLIA === 'yes'
      },
      
      // SECTION 4: LIVE TELEPHONE CALLS
      {
        id: 'tpsScreened',
        section: 'Live Calls',
        sectionIcon: 'üìû',
        type: 'choice',
        question: 'Have you screened your proposed recipient list against the Telephone Preference Service (TPS)?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A - not making live calls' }
        ],
        showIf: (ans) => ans.channels && ans.channels.includes('livecalls')
      },
      {
        id: 'ctpsScreened',
        section: 'Live Calls',
        sectionIcon: 'üìû',
        type: 'choice',
        question: 'Have you screened your proposed recipient list against the Corporate Telephone Preference Service (CTPS)?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A - not making B2B calls' }
        ],
        showIf: (ans) => ans.channels && ans.channels.includes('livecalls') && (ans.audience === 'b2b' || ans.audience === 'both')
      },
      {
        id: 'callSuppression',
        section: 'Live Calls',
        sectionIcon: 'üìû',
        type: 'choice',
        question: 'Have you screened your proposed recipient list against your own customer preference/suppression list for calls?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        showIf: (ans) => ans.channels && ans.channels.includes('livecalls')
      },
      {
        id: 'pensionCalls',
        section: 'Live Calls',
        sectionIcon: 'üìû',
        type: 'choice',
        question: 'Are you making live marketing calls about pension schemes?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.channels && ans.channels.includes('livecalls')
      },
      {
        id: 'pensionAuthorized',
        section: 'Live Calls',
        sectionIcon: 'üìû',
        type: 'choice',
        question: 'If making pension scheme calls, are you either a trustee/manager of the scheme OR authorized by the Financial Conduct Authority?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.pensionCalls === 'yes'
      },
      {
        id: 'pensionConsent',
        section: 'Live Calls',
        sectionIcon: 'üìû',
        type: 'choice',
        question: 'If making pension scheme calls, do you have either consent OR an existing customer relationship with opt-out offered?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.pensionCalls === 'yes'
      },
      {
        id: 'claimsCalls',
        section: 'Live Calls',
        sectionIcon: 'üìû',
        type: 'choice',
        question: 'Are you making live marketing calls about claims management services?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.channels && ans.channels.includes('livecalls')
      },
      {
        id: 'claimsConsent',
        section: 'Live Calls',
        sectionIcon: 'üìû',
        type: 'choice',
        question: 'If making claims management calls, do you have the individual\'s consent?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.claimsCalls === 'yes'
      },
      {
        id: 'displayNumber',
        section: 'Live Calls',
        sectionIcon: 'üìû',
        type: 'choice',
        question: 'Will you display your telephone number (or alternative contact number) to recipients?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        showIf: (ans) => ans.channels && ans.channels.includes('livecalls')
      },
      {
        id: 'provideContact',
        section: 'Live Calls',
        sectionIcon: 'üìû',
        type: 'choice',
        question: 'Will you provide your name and (if asked) a contact address or freephone number during the call?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        showIf: (ans) => ans.channels && ans.channels.includes('livecalls')
      },
      {
        id: 'callTiming',
        section: 'Live Calls',
        sectionIcon: 'üìû',
        type: 'choice',
        question: 'Have you implemented measures to avoid calling people at anti-social hours or causing undue distress to elderly or vulnerable individuals?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        showIf: (ans) => ans.channels && ans.channels.includes('livecalls')
      },
      
      // Continue with remaining sections...
<!-- ============================================ -->
<!-- PART 3B OF 4: JAVASCRIPT - MORE QUESTIONS -->
<!-- Copy this section after Part 3A -->
<!-- ============================================ -->

      // SECTION 5: AUTOMATED CALLS
      {
        id: 'autoConsent',
        section: 'Automated Calls',
        sectionIcon: 'ü§ñ',
        type: 'choice',
        question: 'Do you have explicit consent specifically for automated marketing calls (not just general marketing consent)?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A - not making automated calls' }
        ],
        showIf: (ans) => ans.channels && ans.channels.includes('autocalls')
      },
      {
        id: 'autoMessage',
        section: 'Automated Calls',
        sectionIcon: 'ü§ñ',
        type: 'choice',
        question: 'Will your automated calls include your name and a contact address or freephone number in the message?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.channels && ans.channels.includes('autocalls')
      },
      {
        id: 'autoDisplay',
        section: 'Automated Calls',
        sectionIcon: 'ü§ñ',
        type: 'choice',
        question: 'Will you allow your number (or alternative contact) to be displayed to recipients?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.channels && ans.channels.includes('autocalls')
      },
      
      // SECTION 6: ELECTRONIC MAIL (Email/SMS)
      {
        id: 'recipientType',
        section: 'Electronic Mail',
        sectionIcon: 'üìß',
        type: 'choice',
        question: 'Is the intended recipient an individual subscriber or corporate subscriber?',
        options: [
          { value: 'individual', label: 'Individual subscriber (includes sole traders and some partnerships)' },
          { value: 'corporate', label: 'Corporate subscriber (limited companies, LLPs, Scottish partnerships, some government bodies)' },
          { value: 'unsure', label: 'Unsure' }
        ],
        showIf: (ans) => ans.channels && (ans.channels.includes('email') || ans.channels.includes('sms') || ans.channels.includes('mms'))
      },
      {
        id: 'emailConsent',
        section: 'Electronic Mail',
        sectionIcon: 'üìß',
        type: 'choice',
        question: 'For individual subscribers: Do you have valid consent under PECR for sending electronic mail marketing?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'softoptin', label: 'N/A - relying on soft opt-in' }
        ],
        showIf: (ans) => ans.recipientType === 'individual'
      },
      {
        id: 'consentNamesOrg',
        section: 'Electronic Mail',
        sectionIcon: 'üìß',
        type: 'choice',
        question: 'If relying on consent, does the consent specifically name your organization?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.emailConsent === 'yes'
      },
      {
        id: 'consentCoversType',
        section: 'Electronic Mail',
        sectionIcon: 'üìß',
        type: 'choice',
        question: 'If relying on consent, does it specifically cover the type of electronic mail you want to send (email, text, etc.)?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.emailConsent === 'yes'
      },
      {
        id: 'consentValid',
        section: 'Electronic Mail',
        sectionIcon: 'üìß',
        type: 'choice',
        question: 'Was the consent freely given, specific, informed and unambiguous?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.emailConsent === 'yes'
      },
      {
        id: 'clearOptIn',
        section: 'Electronic Mail',
        sectionIcon: 'üìß',
        type: 'choice',
        question: 'Did you use a clear opt-in mechanism (not pre-ticked boxes)?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.emailConsent === 'yes'
      },
      {
        id: 'softOptIn',
        section: 'Electronic Mail',
        sectionIcon: 'üìß',
        type: 'choice',
        question: 'Do you satisfy ALL the PECR soft opt-in conditions?',
        description: 'Obtained contact details during sale or negotiation of sale to that recipient, marketing is for your similar products/services only, and recipient was given a simple, charge-free opt-out when details were collected and in each subsequent communication.',
        options: [
          { value: 'yes', label: 'Yes - all conditions met' },
          { value: 'no', label: 'No - one or more conditions not met' },
          { value: 'na', label: 'N/A - not using soft opt-in' }
        ],
        showIf: (ans) => ans.emailConsent === 'softoptin'
      },
      {
        id: 'directCollection',
        section: 'Electronic Mail',
        sectionIcon: 'üìß',
        type: 'choice',
        question: 'Did you obtain the contact details directly from the individual (not via a third party)?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.softOptIn === 'yes'
      },
      {
        id: 'similarProducts',
        section: 'Electronic Mail',
        sectionIcon: 'üìß',
        type: 'choice',
        question: 'Is your marketing about similar products/services to what the recipient purchased or negotiated to purchase?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.softOptIn === 'yes'
      },
      {
        id: 'initialOptOut',
        section: 'Electronic Mail',
        sectionIcon: 'üìß',
        type: 'choice',
        question: 'Did you provide a clear opt-out option when you first collected their details?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.softOptIn === 'yes'
      },
      {
        id: 'ongoingOptOut',
        section: 'Electronic Mail',
        sectionIcon: 'üìß',
        type: 'choice',
        question: 'Do you provide a clear opt-out option in every subsequent marketing communication?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        showIf: (ans) => ans.channels && (ans.channels.includes('email') || ans.channels.includes('sms') || ans.channels.includes('mms'))
      },
      {
        id: 'emailSuppression',
        section: 'Electronic Mail',
        sectionIcon: 'üìß',
        type: 'choice',
        question: 'Have you screened your proposed recipient list against your own customer preference/suppression list for electronic mail?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        showIf: (ans) => ans.channels && (ans.channels.includes('email') || ans.channels.includes('sms') || ans.channels.includes('mms'))
      },
      {
        id: 'removedUnsubscribes',
        section: 'Electronic Mail',
        sectionIcon: 'üìß',
        type: 'choice',
        question: 'Have you removed all individuals who have previously objected to or unsubscribed from your electronic mail marketing?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        showIf: (ans) => ans.channels && (ans.channels.includes('email') || ans.channels.includes('sms') || ans.channels.includes('mms'))
      },
      
      // SECTION 7: POSTAL MARKETING
      {
        id: 'mpsScreened',
        section: 'Postal Marketing',
        sectionIcon: 'üì¨',
        type: 'choice',
        question: 'Have you screened your mailing list against the Mailing Preference Service (MPS)?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A - not sending postal marketing' }
        ],
        showIf: (ans) => ans.channels && ans.channels.includes('post')
      },
      {
        id: 'postalSuppression',
        section: 'Postal Marketing',
        sectionIcon: 'üì¨',
        type: 'choice',
        question: 'Have you screened your mailing list against your own suppression list for postal marketing?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.channels && ans.channels.includes('post')
      },
      {
        id: 'postalLawfulBasis',
        section: 'Postal Marketing',
        sectionIcon: 'üì¨',
        type: 'choice',
        question: 'If using personal data for postal marketing, do you have a valid lawful basis under UK GDPR?',
        options: [
          { value: 'legitimate', label: 'Yes - legitimate interests with documented LIA' },
          { value: 'consent', label: 'Yes - consent' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A - not processing personal data' }
        ],
        showIf: (ans) => ans.channels && ans.channels.includes('post')
      },
      
      // SECTION 8: FAX MARKETING
      {
        id: 'sendingFax',
        section: 'Fax Marketing',
        sectionIcon: 'üì†',
        type: 'choice',
        question: 'Are you sending marketing by fax?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        showIf: (ans) => ans.channels && ans.channels.includes('fax')
      },
      {
        id: 'fpsScreened',
        section: 'Fax Marketing',
        sectionIcon: 'üì†',
        type: 'choice',
        question: 'If yes, have you screened against the Fax Preference Service (FPS)?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.sendingFax === 'yes'
      },
      {
        id: 'faxConsent',
        section: 'Fax Marketing',
        sectionIcon: 'üì†',
        type: 'choice',
        question: 'For individual subscribers, do you have their consent for fax marketing?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A - sending to corporate subscribers only' }
        ],
        showIf: (ans) => ans.sendingFax === 'yes'
      },
      
      // SECTION 9: ONLINE BEHAVIORAL ADVERTISING
      {
        id: 'usesCookies',
        section: 'Online Advertising',
        sectionIcon: 'üåê',
        type: 'choice',
        question: 'Will your online advertising use cookies or similar tracking technologies?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A - not doing online advertising' }
        ],
        showIf: (ans) => ans.channels && (ans.channels.includes('behavioral') || ans.channels.includes('socialads'))
      },
      {
        id: 'cookieConsent',
        section: 'Online Advertising',
        sectionIcon: 'üåê',
        type: 'choice',
        question: 'If yes, have you obtained valid consent for storing/accessing information on users\' devices?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.usesCookies === 'yes'
      },
      {
        id: 'cookieInfo',
        section: 'Online Advertising',
        sectionIcon: 'üåê',
        type: 'choice',
        question: 'Have you provided clear and comprehensive information about what the cookies/tracking technologies do?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.usesCookies === 'yes'
      },
      {
        id: 'trackingPixels',
        section: 'Online Advertising',
        sectionIcon: 'üåê',
        type: 'choice',
        question: 'Are you using tracking pixels in your direct marketing emails?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        showIf: (ans) => ans.channels && ans.channels.includes('email')
      },
      {
        id: 'pixelCompliance',
        section: 'Online Advertising',
        sectionIcon: 'üåê',
        type: 'choice',
        question: 'If using tracking pixels, have you complied with PECR rules on cookies and similar technologies?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' },
          { value: 'na', label: 'N/A' }
        ],
        showIf: (ans) => ans.trackingPixels === 'yes'
      },
      
      // More sections continue in Part 3C...
<!-- ============================================ -->
<!-- PART 3C OF 4: JAVASCRIPT - REMAINING QUESTIONS + CORE LOGIC -->
<!-- Copy this section after Part 3B -->
<!-- ============================================ -->

      // SECTION 10-15: Additional sections (condensed for space)
      // Add more questions as needed from your Word doc...
      
      // TRANSPARENCY & OPT-OUTS
      {
        id: 'privacyInfo',
        section: 'Transparency',
        sectionIcon: 'üìÑ',
        type: 'choice',
        question: 'Have you provided individuals with clear privacy information explaining your direct marketing activities?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        required: true
      },
      {
        id: 'optOutProcess',
        section: 'Opt-Outs',
        sectionIcon: 'üö´',
        type: 'choice',
        question: 'Do you have a clear and simple process for individuals to object to or opt-out of your direct marketing?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        required: true
      },
      {
        id: 'suppressionList',
        section: 'Opt-Outs',
        sectionIcon: 'üö´',
        type: 'choice',
        question: 'Do you have a suppression list system to record and honor objections?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        required: true
      },
      {
        id: 'documentedCompliance',
        section: 'Accountability',
        sectionIcon: 'üìä',
        type: 'choice',
        question: 'Have you documented your decisions regarding lawful basis, LIA, and compliance measures?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        required: true
      },
      {
        id: 'staffTraining',
        section: 'Accountability',
        sectionIcon: 'üìä',
        type: 'choice',
        question: 'Have you trained staff involved in direct marketing on data protection and PECR requirements?',
        options: [
          { value: 'yes', label: 'Yes' },
          { value: 'no', label: 'No' }
        ],
        required: true
      },
      {
        id: 'confident',
        section: 'Final Checks',
        sectionIcon: 'üéØ',
        type: 'choice',
        question: 'Are you confident your campaign complies with all applicable UK GDPR and PECR requirements?',
        options: [
          { value: 'yes', label: 'Yes - ready to proceed' },
          { value: 'no', label: 'No - need to address issues' },
          { value: 'unsure', label: 'Unsure - need legal review' }
        ],
        required: true
      }
    ];
    
    // =========================
    // STATE MANAGEMENT
    // =========================
    let currentQuestionIndex = 0;
    let answers = {};
    let visibleQuestions = [];
    
    // =========================
    // HELPER FUNCTIONS
    // =========================
    
    function calculateVisibleQuestions() {
      visibleQuestions = questions.filter(q => {
        if (!q.showIf) return true;
        return q.showIf(answers);
      });
    }
    
    function getUniqueSections() {
      const sections = {};
      visibleQuestions.forEach(q => {
        if (!sections[q.section]) {
          sections[q.section] = {
            name: q.section,
            icon: q.sectionIcon,
            questions: []
          };
        }
        sections[q.section].questions.push(q);
      });
      return Object.values(sections);
    }
    
    function updateComplianceScore() {
      calculateVisibleQuestions();
      const answeredQuestions = visibleQuestions.filter(q => answers[q.id] !== undefined);
      const totalQuestions = visibleQuestions.length;
      
      let compliantAnswers = 0;
      
      answeredQuestions.forEach(q => {
        const answer = answers[q.id];
        const compliantValues = ['yes', 'all', 'completed', 'legitimate', 'consent'];
        
        if (Array.isArray(answer)) {
          compliantAnswers += 0.5;
        } else if (compliantValues.includes(answer)) {
          compliantAnswers += 1;
        } else if (['partial', 'depends', 'unsure'].includes(answer)) {
          compliantAnswers += 0.5;
        }
      });
      
      const percentage = totalQuestions > 0 ? Math.round((compliantAnswers / totalQuestions) * 100) : 0;
      
      document.getElementById('complianceScore').textContent = percentage + '%';
      document.getElementById('scoreBarFill').style.width = percentage + '%';
      document.getElementById('headerScore').textContent = percentage + '%';
      
      const riskIndicator = document.getElementById('riskIndicator');
      if (percentage >= 85) {
        riskIndicator.textContent = '‚úÖ High Compliance';
        riskIndicator.style.background = 'rgba(34, 197, 94, 0.3)';
      } else if (percentage >= 70) {
        riskIndicator.textContent = '‚ö†Ô∏è Moderate Risk';
        riskIndicator.style.background = 'rgba(251, 191, 36, 0.3)';
      } else if (percentage >= 50) {
        riskIndicator.textContent = '‚ö†Ô∏è High Risk';
        riskIndicator.style.background = 'rgba(249, 115, 22, 0.3)';
      } else {
        riskIndicator.textContent = 'üö´ Critical Issues';
        riskIndicator.style.background = 'rgba(239, 68, 68, 0.3)';
      }
      
      if (answeredQuestions.length > 0) {
        document.getElementById('headerScoreBadge').classList.add('visible');
      }
      
      if (percentage === 100 && answeredQuestions.length === totalQuestions) {
        triggerConfetti();
      }
    }
    
    function triggerConfetti() {
      const colors = ['#f97316', '#ea580c', '#22c55e', '#3b82f6', '#a855f7'];
      for (let i = 0; i < 50; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.left = Math.random() * window.innerWidth + 'px';
          confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.animationDelay = Math.random() * 0.5 + 's';
          document.body.appendChild(confetti);
          setTimeout(() => confetti.remove(), 3000);
        }, i * 30);
      }
    }
    
    function updateSectionProgress() {
      const sectionProgress = document.getElementById('sectionProgress');
      const sections = getUniqueSections();
      let html = '';
      
      sections.forEach(section => {
        const sectionQuestions = section.questions;
        const answeredInSection = sectionQuestions.filter(q => answers[q.id] !== undefined).length;
        const totalInSection = sectionQuestions.length;
        const isComplete = answeredInSection === totalInSection && totalInSection > 0;
        const isActive = sectionQuestions.some((q) => visibleQuestions.indexOf(q) === currentQuestionIndex);
        
        if (totalInSection > 0) {
          html += `
            <div class="section-item ${isActive ? 'active' : ''} ${isComplete ? 'completed' : ''}">
              <div class="section-icon">${isComplete ? '‚úì' : section.icon}</div>
              <div class="section-info">
                <div class="section-name">${section.name}</div>
                <div class="section-questions">${answeredInSection}/${totalInSection} answered</div>
              </div>
            </div>
          `;
        }
      });
      
      sectionProgress.innerHTML = html;
    }
    
    // Continue in Part 3D...
<!-- ============================================ -->
<!-- PART 3D OF 4: JAVASCRIPT - MAIN FUNCTIONS & CLOSING -->
<!-- Copy this section after Part 3C -->
<!-- ============================================ -->

    function renderQuestion() {
      calculateVisibleQuestions();
      updateComplianceScore();
      updateSectionProgress();
      
      const question = visibleQuestions[currentQuestionIndex];
      if (!question) return;
      
      const formContent = document.getElementById('formContent');
      
      let questionHTML = `
        <div class="question-container active">
          <div class="question-meta">
            <span>Question ${currentQuestionIndex + 1} of ${visibleQuestions.length}</span>
            <span class="section-badge">${question.sectionIcon} ${question.section}</span>
          </div>
          <h2 class="question-text">${question.question}</h2>
      `;
      
      if (question.description) {
        questionHTML += `<p class="question-description">${question.description}</p>`;
      }
      
      if (question.type === 'text') {
        const value = answers[question.id] || '';
        questionHTML += `<input type="text" id="answer" value="${value}" placeholder="Type your answer here..." />`;
      } else if (question.type === 'multi-select') {
        questionHTML += '<div class="options-container">';
        question.options.forEach(option => {
          const selected = answers[question.id] && answers[question.id].includes(option.value) ? 'selected' : '';
          questionHTML += `
            <button type="button" class="option-button checkbox ${selected}" data-value="${option.value}">
              ${option.label}
            </button>
          `;
        });
        questionHTML += '</div>';
      } else if (question.type === 'choice') {
        questionHTML += '<div class="options-container">';
        question.options.forEach(option => {
          const selected = answers[question.id] === option.value ? 'selected' : '';
          questionHTML += `
            <button type="button" class="option-button ${selected}" data-value="${option.value}">
              ${option.label}
            </button>
          `;
        });
        questionHTML += '</div>';
      }
      
      questionHTML += `
          <div class="button-group">
            ${currentQuestionIndex > 0 ? '<button type="button" class="btn-secondary" onclick="previousQuestion()">Back</button>' : '<button type="button" class="btn-secondary" onclick="cancelForm()">Cancel</button>'}
            <button type="button" class="btn-primary" id="nextButton" onclick="nextQuestion()" ${!answers[question.id] ? 'disabled' : ''}>
              ${currentQuestionIndex === visibleQuestions.length - 1 ? 'Complete Assessment' : 'Next'}
            </button>
          </div>
        </div>
      `;
      
      formContent.innerHTML = questionHTML;
      
      if (question.type === 'text') {
        const input = document.getElementById('answer');
        input.addEventListener('input', (e) => {
          answers[question.id] = e.target.value;
          document.getElementById('nextButton').disabled = !e.target.value.trim();
          triggerAutoSave();
        });
        input.focus();
      } else if (question.type === 'multi-select') {
        document.querySelectorAll('.option-button').forEach(button => {
          button.addEventListener('click', (e) => {
            e.target.classList.toggle('selected');
            const selectedValues = Array.from(document.querySelectorAll('.option-button.selected'))
              .map(btn => btn.dataset.value);
            answers[question.id] = selectedValues.length > 0 ? selectedValues : undefined;
            document.getElementById('nextButton').disabled = selectedValues.length === 0;
            triggerAutoSave();
            updateComplianceScore();
          });
        });
      } else if (question.type === 'choice') {
        document.querySelectorAll('.option-button').forEach(button => {
          button.addEventListener('click', (e) => {
            document.querySelectorAll('.option-button').forEach(b => b.classList.remove('selected'));
            e.target.classList.add('selected');
            answers[question.id] = e.target.dataset.value;
            document.getElementById('nextButton').disabled = false;
            triggerAutoSave();
            updateComplianceScore();
          });
        });
      }
    }
    
    function nextQuestion() {
      if (currentQuestionIndex < visibleQuestions.length - 1) {
        currentQuestionIndex++;
        renderQuestion();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } else {
        submitForm();
      }
    }
    
    function previousQuestion() {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        renderQuestion();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }
    
    // AUTO-SAVE FUNCTIONALITY
    function triggerAutoSave() {
      clearTimeout(autoSaveTimeout);
      autoSaveTimeout = setTimeout(() => {
        saveDraft();
      }, AUTO_SAVE_DELAY);
    }
    
    async function saveDraft() {
      const indicator = document.getElementById('autoSaveIndicator');
      indicator.classList.add('visible');
      
      try {
        const draftData = {
          answers: answers,
          currentQuestionIndex: currentQuestionIndex,
          lastSaved: new Date().toISOString()
        };
        localStorage.setItem('compliance_draft', JSON.stringify(draftData));
        setTimeout(() => {
          indicator.classList.remove('visible');
        }, 1500);
      } catch (error) {
        console.error('Auto-save error:', error);
        indicator.classList.remove('visible');
      }
    }
    
    function loadDraft() {
      try {
        const draft = localStorage.getItem('compliance_draft');
        if (draft) {
          const draftData = JSON.parse(draft);
          if (confirm('We found a saved draft from ' + new Date(draftData.lastSaved).toLocaleString() + '. Would you like to continue where you left off?')) {
            answers = draftData.answers;
            currentQuestionIndex = draftData.currentQuestionIndex;
            return true;
          }
        }
      } catch (error) {
        console.error('Error loading draft:', error);
      }
      return false;
    }
    
    function clearDraft() {
      localStorage.removeItem('compliance_draft');
    }
    
    // RESULTS & SCORING
    function calculateResults() {
      const results = {
        overallScore: 0,
        sectionScores: {},
        criticalIssues: [],
        recommendations: [],
        riskLevel: 'low'
      };
      
      const sections = getUniqueSections();
      sections.forEach(section => {
        const sectionQuestions = section.questions;
        if (sectionQuestions.length === 0) return;
        
        let sectionScore = 0;
        let sectionTotal = sectionQuestions.length;
        
        sectionQuestions.forEach(q => {
          const answer = answers[q.id];
          if (answer === 'yes' || answer === 'all' || answer === 'completed') {
            sectionScore += 1;
          } else if (answer === 'partial' || answer === 'depends' || answer === 'unsure') {
            sectionScore += 0.5;
          } else if (answer === 'no') {
            results.criticalIssues.push({
              section: section.name,
              question: q.question,
              issue: 'Non-compliant answer'
            });
          }
        });
        
        results.sectionScores[section.name] = {
          name: section.name,
          icon: section.icon,
          score: Math.round((sectionScore / sectionTotal) * 100),
          answeredQuestions: sectionQuestions.filter(q => answers[q.id] !== undefined).length,
          totalQuestions: sectionTotal
        };
      });
      
      const allSectionScores = Object.values(results.sectionScores).map(s => s.score);
      results.overallScore = allSectionScores.length > 0 
        ? Math.round(allSectionScores.reduce((a, b) => a + b, 0) / allSectionScores.length)
        : 0;
      
      if (results.overallScore >= 85) {
        results.riskLevel = 'low';
      } else if (results.overallScore >= 70) {
        results.riskLevel = 'medium';
      } else {
        results.riskLevel = 'high';
      }
      
      if (results.criticalIssues.length > 0) {
        results.recommendations.push({
          title: 'Address Critical Compliance Issues',
          description: `You have ${results.criticalIssues.length} critical compliance issues that must be resolved before proceeding with your campaign.`
        });
      }
      
      if (!answers.documentedCompliance || answers.documentedCompliance === 'no') {
        results.recommendations.push({
          title: 'Document Your Compliance Measures',
          description: 'Ensure you have clear records of your compliance decisions and measures. This is essential for demonstrating accountability.'
        });
      }
      
      if (!answers.staffTraining || answers.staffTraining === 'no') {
        results.recommendations.push({
          title: 'Train Your Staff',
          description: 'Provide comprehensive training to all staff involved in direct marketing on data protection and PECR requirements.'
        });
      }
      
      return results;
    }
    
    function displayResults(results) {
      document.getElementById('formContent').style.display = 'none';
      document.getElementById('loading').classList.remove('active');
      document.getElementById('resultContainer').classList.add('active');
      
      const resultIcon = document.getElementById('resultIcon');
      const resultTitle = document.getElementById('resultTitle');
      const resultMessage = document.getElementById('resultMessage');
      
      if (results.riskLevel === 'low') {
        resultIcon.textContent = '‚úÖ';
        resultTitle.textContent = 'Excellent Compliance!';
        resultTitle.style.color = '#10b981';
        resultMessage.textContent = `Your campaign scored ${results.overallScore}% and appears to be highly compliant with GDPR/PECR regulations.`;
      } else if (results.riskLevel === 'medium') {
        resultIcon.textContent = '‚ö†Ô∏è';
        resultTitle.textContent = 'Action Required';
        resultTitle.style.color = '#f59e0b';
        resultMessage.textContent = `Your campaign scored ${results.overallScore}%. There are some compliance gaps that should be addressed before proceeding.`;
      } else {
        resultIcon.textContent = 'üö´';
        resultTitle.textContent = 'Critical Issues Found';
        resultTitle.style.color = '#ef4444';
        resultMessage.textContent = `Your campaign scored ${results.overallScore}% and has significant compliance issues. We strongly recommend addressing these before proceeding.`;
      }
      
      const heatmapGrid = document.getElementById('heatmapGrid');
      let heatmapHTML = '';
      
      Object.values(results.sectionScores).forEach(section => {
        const riskClass = section.score >= 80 ? 'risk-low' : section.score >= 60 ? 'risk-medium' : 'risk-high';
        heatmapHTML += `
          <div class="heatmap-item ${riskClass}">
            <h4>${section.icon} ${section.name}</h4>
            <div class="score">${section.score}%</div>
          </div>
        `;
      });
      
      heatmapGrid.innerHTML = heatmapHTML;
      
      const recommendationsList = document.getElementById('recommendationsList');
      let recommendationsHTML = '';
      
      if (results.recommendations.length === 0) {
        recommendationsHTML = '<p style="text-align: center; color: #666;">No specific recommendations - great work!</p>';
      } else {
        results.recommendations.forEach(rec => {
          recommendationsHTML += `
            <div class="recommendation-item">
              <h4>${rec.title}</h4>
              <p>${rec.description}</p>
            </div>
          `;
        });
      }
      
      recommendationsList.innerHTML = recommendationsHTML;
    }
    
    function determineResultCategory(results) {
      if (results.overallScore >= 85) {
        return 'Send this Wizely';
      } else if (results.overallScore >= 70) {
        return 'Review Recommended';
      } else if (results.overallScore >= 50) {
        return 'Not Wize to send';
      } else {
        return 'STOP AND RE-THINK THIS CAMPAIGN';
      }
    }
    
    async function submitForm() {
      document.getElementById('formContent').style.display = 'none';
      document.getElementById('loading').classList.add('active');
      
      try {
        const { data: member } = await window.$memberstackDom.getCurrentMember();
        
        if (!member) {
          throw new Error('You must be logged in to submit the form');
        }
        
        const results = calculateResults();
        const resultCategory = determineResultCategory(results);
        
        const submissionData = {
          records: [{
            fields: {
              UserID: member.id,
              CampaignName: answers.campaignName || 'Unnamed Campaign',
              SubmissionDate: new Date().toISOString().split('T')[0],
              Result: resultCategory,
              Score: results.overallScore,
              Answers: JSON.stringify(answers, null, 2),
              Results: JSON.stringify(results, null, 2)
            }
          }]
        };
        
        // Call Vercel serverless function instead of Airtable directly
        const response = await fetch('/.netlify/functions/submit-check', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(submissionData)
        });
        
        if (!response.ok) {
          throw new Error('Failed to save to Airtable');
        }
        
        clearDraft();
        displayResults(results);
        await loadResults();
        
      } catch (error) {
        console.error('Error:', error);
        alert(error.message || 'Something went wrong. Please try again.');
        document.getElementById('loading').classList.remove('active');
        document.getElementById('formContent').style.display = 'block';
      }
    }
    
    // DASHBOARD FUNCTIONS (PRESERVED FROM YOUR ORIGINAL)
    async function loadResults() {
      try {
        const { data: member } = await window.$memberstackDom.getCurrentMember();
        
        if (!member) {
          document.getElementById('results-container').innerHTML = 
            '<div class="empty-state"><h2>Please Log In</h2><p>You need to be logged in to view your compliance checks.</p></div>';
          return;
        }
        
        // Call Vercel serverless function instead of Airtable directly
        const response = await fetch(`/.netlify/functions/load-results?userId=${member.id}`);
        
        if (!response.ok) {
          throw new Error('Failed to fetch data');
        }
        
        const data = await response.json();
        document.getElementById('totalChecks').textContent = data.records.length;
        
        let html = '';
        
        if (data.records.length === 0) {
          html = '<div class="empty-state"><h2>No compliance checks yet</h2><p>Click "New Check" above to get started!</p></div>';
        } else {
          html = '<div class="dashboard-grid">';
          
          data.records.forEach(record => {
            const fields = record.fields;
            const date = fields.SubmissionDate ? new Date(fields.SubmissionDate).toLocaleDateString() : 'Date not set';
            const result = fields.Result || 'Pending';
            const campaign = fields.CampaignName || 'Unnamed Campaign';
            const score = fields.Score || 0;
            
            let cardClass = '';
            if (result === 'Send this Wizely') {
              cardClass = 'compliant';
            } else if (result === 'Review Recommended') {
              cardClass = 'warning';
            } else {
              cardClass = 'non-compliant';
            }
            
            html += `
              <div class="dashboard-card ${cardClass}">
                <h3>${campaign}</h3>
                <div class="result-badge">${result}</div>
                <div class="score-display-mini">
                  <div class="score-number-mini">${score}%</div>
                  <div style="flex: 1; font-size: 14px; color: #666;">Compliance</div>
                </div>
                <p class="date">${date}</p>
              </div>
            `;
          });
          
          html += '</div>';
        }
        
        document.getElementById('results-container').innerHTML = html;
      } catch (error) {
        console.error('Error:', error);
        document.getElementById('results-container').innerHTML = 
          '<div class="empty-state" style="color: #ef4444;"><h2>Error loading results</h2><p>Please refresh the page or contact support.</p></div>';
      }
    }
    
    // UI CONTROL FUNCTIONS
    function showForm() {
      currentQuestionIndex = 0;
      answers = {};
      loadDraft();
      
      document.getElementById('formContainer').classList.remove('hidden');
      document.getElementById('resultContainer').classList.remove('active');
      document.getElementById('loading').classList.remove('active');
      document.getElementById('formContent').style.display = 'block';
      document.getElementById('newCheckButton').style.display = 'none';
      document.getElementById('headerScoreBadge').classList.add('visible');
      
      renderQuestion();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    function backToDashboard() {
      // Redirect back to Webflow dashboard
      window.location.href = redirectUrl;
    }
    
    function cancelForm() {
      if (confirm('Are you sure you want to cancel? Your progress will be saved as a draft.')) {
        saveDraft();
        backToDashboard();
      }
    }
    
    // INITIALIZATION - Auto-show form
    async function init() {
      try {
        // Wait for Memberstack to be ready
        if (!window.$memberstackDom) {
          console.log('Waiting for Memberstack...');
          setTimeout(init, 100);
          return;
        }
        
        const { data: member } = await window.$memberstackDom.getCurrentMember();
        
        if (!member) {
          document.getElementById('formContainer').innerHTML = `
            <div class="empty-state" style="text-align: center; padding: 100px 40px;">
              <h2>Please Log In</h2>
              <p>Please log in through your dashboard to use the compliance checker.</p>
              <p style="margin-top: 20px;"><a href="${redirectUrl}" style="color: #f97316; text-decoration: underline;">Return to Dashboard</a></p>
            </div>
          `;
          document.getElementById('formContainer').classList.remove('hidden');
          return;
        }
        
        // Auto-show the form
        showForm();
        
      } catch (error) {
        console.error('Initialization error:', error);
        document.getElementById('formContainer').innerHTML = `
          <div class="empty-state" style="text-align: center; padding: 100px 40px;">
            <h2>Error</h2>
            <p>Failed to load. Please try refreshing the page.</p>
            <p style="margin-top: 20px;"><a href="${redirectUrl}" style="color: #f97316; text-decoration: underline;">Return to Dashboard</a></p>
          </div>
        `;
        document.getElementById('formContainer').classList.remove('hidden');
      }
    }
    
    // Wait for both DOM and Memberstack to be ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>

<!-- ============================================ -->
<!-- END OF CODE - PASTE ALL 4 PARTS IN ORDER INTO YOUR WEBFLOW CODE EMBED -->
<!-- Part 1: HTML + CSS -->
<!-- Part 2: HTML Body -->
<!-- Part 3A: JavaScript Config + Questions A -->
<!-- Part 3B: JavaScript Questions B -->
<!-- Part 3C: JavaScript Questions C + Core Logic -->
<!-- Part 3D: JavaScript Functions + Closing -->
<!-- ============================================ -->
